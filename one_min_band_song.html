<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>One-Minute Expanded Concert Band</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  button { padding: 10px 16px; font-size: 16px; cursor: pointer; }
  #status { margin-top: 10px; color: green; }
  #error { margin-top: 10px; color: red; white-space: pre-wrap; }
</style>
</head>
<body>
  <h1>ðŸŽ¶ One-Minute Expanded Concert Band</h1>
  <p>Click play to hear a full band arrangement with an even bigger instrument lineup.</p>
  <button id="playBtn">Play Song</button>
  <div id="status"></div>
  <div id="error"></div>

  <script src="https://unpkg.com/soundfont-player@0.15.7/dist/soundfont-player.js"></script>
  <script>
  const BPM = 120;
  const BEAT = 60 / BPM;
  const BAR = BEAT * 4;
  const TOTAL_BARS = 30;

  const INSTRUMENTS = {
    piccolo: 'piccolo',
    flute: 'flute',
    clarinet: 'clarinet',
    bassClarinet: 'bass_clarinet',
    oboe: 'oboe',
    bassoon: 'bassoon',
    altoSax: 'alto_sax',
    tenorSax: 'tenor_sax',
    trumpet: 'trumpet',
    horn: 'french_horn',
    trombone: 'trombone',
    euphonium: 'euphonium',
    tuba: 'tuba',
    piano: 'acoustic_grand_piano',
    celesta: 'celesta',
    bass: 'acoustic_bass',
    glock: 'glockenspiel',
    vibraphone: 'vibraphone',
    marimba: 'marimba',
    xylo: 'xylophone',
    timp: 'timpani',
    snare: 'snare_drum',
    cymbal: 'crash_cymbal',
    bassDrum: 'bass_drum'
  };

  const PROG = [
    {root:'G', type:'maj'},
    {root:'E', type:'min'},
    {root:'C', type:'maj'},
    {root:'D', type:'maj'}
  ];

  let ac, loaded = {}, started = false;
  const statusEl = document.getElementById('status');
  const errorEl = document.getElementById('error');

  function setStatus(msg) { statusEl.textContent = msg; }
  function setError(msg) { errorEl.textContent = msg; }

  function transpose(note, semitones) {
    const order = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
    const m = note.match(/^([A-G]#?)(-?\d)$/);
    if (!m) return note;
    const idx = order.indexOf(m[1]);
    const octave = parseInt(m[2], 10);
    let n = idx + semitones;
    let newOct = octave + Math.floor(n / 12);
    n = ((n % 12) + 12) % 12;
    return order[n] + newOct;
  }

  function chord(root, type='maj', octave=3) {
    const map = { maj: [0,4,7], min: [0,3,7] };
    return map[type].map(s => transpose(root + octave, s));
  }

  function scheduleSong() {
    const startAt = ac.currentTime + 0.1;

    // Piano + celesta chords
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      const {root, type} = PROG[bar % PROG.length];
      const triad = chord(root, type, 4);
      [0, 2].forEach(beat => {
        triad.forEach((n, i) => {
          loaded.piano.play(n, startAt + t + beat*BEAT + i*0.01, { gain: 0.07, duration: 0.22 });
          loaded.celesta.play(n, startAt + t + beat*BEAT + i*0.01, { gain: 0.05, duration: 0.22 });
        });
      });
    }

    // Bass line (tuba + bass + euphonium)
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      const {root} = PROG[bar % PROG.length];
      const rootNote = root + '2';
      [loaded.tuba, loaded.bass, loaded.euphonium].forEach((inst, idx) => {
        inst.play(rootNote, startAt + t + idx*0.05, { gain: 0.15, duration: 0.35 });
      });
    }

    // Brass stabs (trumpet, horn, trombone)
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      const {root, type} = PROG[bar % PROG.length];
      const triad3 = chord(root, type, 3);
      [1, 3].forEach(beat => {
        triad3.forEach(n => {
          loaded.trumpet.play(n, startAt + t + beat*BEAT, { gain: 0.14, duration: 0.45 });
          loaded.horn.play(n, startAt + t + beat*BEAT + 0.02, { gain: 0.14, duration: 0.45 });
          loaded.trombone.play(n, startAt + t + beat*BEAT + 0.04, { gain: 0.14, duration: 0.45 });
        });
      });
    }

    // Woodwind melody (piccolo, flute, clarinet, bass clarinet, oboe, bassoon, saxes)
    const winds = [loaded.piccolo, loaded.flute, loaded.clarinet, loaded.bassClarinet, loaded.oboe, loaded.bassoon, loaded.altoSax, loaded.tenorSax];
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      const lead = winds[bar % winds.length];
      const note = ['G5','A5','B5','C6','D6','E6','F#6'][bar % 7];
      lead.play(note, startAt + t, { gain: 0.16, duration: 0.35 });
    }

    // Mallet percussion (glock, vibraphone, marimba, xylophone)
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      const {root, type} = PROG[bar % PROG.length];
      const triad5 = chord(root, type, 5);
      [0.5, 1.5, 2.5, 3.5].forEach(off => {
        [loaded.glock, loaded.vibraphone, loaded.marimba, loaded.xylo].forEach((inst, idx) => {
          inst.play(triad5[idx % triad5.length], startAt + t + off*BEAT + idx*0.01, { gain: 0.08, duration: 0.18 });
        });
      });
    }

    // Percussion: timpani, snare, cymbal, bass drum
    for (let bar = 0; bar < TOTAL_BARS; bar++) {
      const t = bar * BAR;
      if (bar % 2 === 0) loaded.timp.play(PROG[bar % PROG.length].root + '2', startAt + t, { gain: 0.2, duration: 0.6 });
      loaded.snare.play('C3', startAt + t + 1*BEAT, { gain: 0.12, duration: 0.1 });
      loaded.cymbal.play('C4', startAt + t + 3*BEAT, { gain: 0.15, duration: 1.0 });
      if (bar % 4 === 0) loaded.bassDrum.play('C2', startAt + t, { gain: 0.18, duration: 0.5 });
    }

