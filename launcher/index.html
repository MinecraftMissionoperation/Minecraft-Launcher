<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Eaglercraft Launcher</title>
  <style>
    :root {
      color-scheme: dark light;
      --bg: #0f1115;
      --fg: #e6e6e6;
      --muted: #a3a3a3;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --danger: #f87171;
      --card: #171923;
      --border: #24283a;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%; margin: 0; background: var(--bg); color: var(--fg);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap {
      display: grid; grid-template-rows: auto 1fr; height: 100%;
    }
    header {
      display: grid; gap: .75rem; align-items: center; grid-template-columns: 1fr auto auto auto;
      padding: .75rem 1rem; background: var(--card); border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 5;
    }
    .brand { font-weight: 700; letter-spacing:.2px; }
    .controls { display: flex; gap: .5rem; align-items: center; justify-content: flex-end; }
    select, button {
      appearance: none; border: 1px solid var(--border); background: #11131a; color: var(--fg);
      padding: .5rem .65rem; border-radius: .5rem; cursor: pointer;
    }
    select { min-width: 200px; }
    button.primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0a0b0f; border: none; font-weight: 700; }
    button.ghost { background: #10131a; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .status { color: var(--muted); font-size: 12px; }
    main { position: relative; }
    .stage {
      position: absolute; inset: 0; display: grid; place-items: center; background: #0b0d13;
    }
    iframe {
      width: 100%; height: 100%; border: none; background: #000;
    }
    .placeholder {
      display: grid; gap: .75rem; place-items: center; text-align: center; max-width: 520px; margin: 0 1rem;
      color: var(--muted);
    }
    .loading {
      position: absolute; top: .75rem; right: .75rem; padding: .35rem .5rem; border-radius: .375rem;
      background: rgba(0,0,0,.35); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); font-size: 12px;
      border: 1px solid var(--border);
    }
    .error {
      color: var(--danger); font-weight: 600;
    }
    @media (max-width: 640px) {
      header { grid-template-columns: 1fr; grid-auto-rows: auto; }
      .controls { justify-content: stretch; flex-wrap: wrap; }
      select { min-width: 0; width: 100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Eaglercraft Launcher</div>
      <div class="status" id="status">Pick a version to start</div>
      <div class="controls">
        <select id="versionSelect" aria-label="Eaglercraft version"></select>
        <button id="playBtn" class="primary">Play</button>
        <button id="fullscreenBtn" class="ghost" title="Toggle fullscreen (F)">Fullscreen</button>
      </div>
    </header>

    <main>
      <div class="stage" id="stage">
        <div class="placeholder" id="placeholder">
          <div style="font-size:18px;font-weight:700;">Ready to play</div>
          <div>Select a version above and hit Play. You can add more versions anytime.</div>
          <div style="font-size:12px;opacity:.8;">Tip: Press F to toggle fullscreen while playing.</div>
        </div>
        <iframe id="gameFrame" title="Eaglercraft" hidden></iframe>
        <div class="loading" id="loading" hidden>Loading…</div>
      </div>
    </main>
  </div>

  <script>
    // Configure your available versions here.
    // id: stable identifier for URLs/localStorage
    // name: display label
    // path: relative path to the version folder containing its index.html
    const VERSIONS = [
      { id: "1.5.2", name: "Eaglercraft 1.5.2", path: "./versions/1.5.2/index.html" },
      { id: "1.8.8", name: "Eaglercraft 1.8.8", path: "./versions/1.8.8/index.html" },
      { id: "b1.3",  name: "Eaglercraft Beta 1.3", path: "./versions/b1.3/index.html" }
    ];

    const sel = document.getElementById("versionSelect");
    const playBtn = document.getElementById("playBtn");
    const fsBtn = document.getElementById("fullscreenBtn");
    const frame = document.getElementById("gameFrame");
    const placeholder = document.getElementById("placeholder");
    const loading = document.getElementById("loading");
    const statusEl = document.getElementById("status");

    // Populate dropdown
    function populate() {
      sel.innerHTML = "";
      VERSIONS.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v.id;
        opt.textContent = v.name;
        sel.appendChild(opt);
      });
    }

    // Helpers
    const getVersionById = id => VERSIONS.find(v => v.id === id);
    const setStatus = (msg) => { statusEl.textContent = msg; }

    // Persist/restore choice via localStorage and URL (?version=)
    function initialSelection() {
      const params = new URLSearchParams(location.search);
      const q = params.get("version");
      if (q && getVersionById(q)) return q;
      const saved = localStorage.getItem("eagler:lastVersion");
      if (saved && getVersionById(saved)) return saved;
      return VERSIONS[0]?.id || "";
    }

    function setQueryVersion(id) {
      const url = new URL(location.href);
      url.searchParams.set("version", id);
      history.replaceState({}, "", url);
    }

    // Load a version into the iframe
    async function loadVersion(id) {
      const v = getVersionById(id);
      if (!v) {
        setStatus("Version not found");
        return;
      }
      loading.hidden = false;
      frame.hidden = true;
      placeholder.hidden = true;
      setStatus(`Launching ${v.name}…`);
      try {
        // Preflight: check the index exists (same-origin recommended)
        const res = await fetch(v.path, { method: "HEAD", cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        frame.src = v.path;
        // Wait for load or fail
        await new Promise((resolve, reject) => {
          const onLoad = () => { cleanup(); resolve(); };
          const onErr = () => { cleanup(); reject(new Error("Failed to load the selected version.")); };
          const cleanup = () => {
            frame.removeEventListener("load", onLoad);
            frame.removeEventListener("error", onErr);
          };
          frame.addEventListener("load", onLoad, { once: true });
          frame.addEventListener("error", onErr, { once: true });
        });
        frame.hidden = false;
        setStatus(`Playing ${v.name}`);
        localStorage.setItem("eagler:lastVersion", id);
        setQueryVersion(id);
      } catch (e) {
        frame.hidden = true;
        placeholder.hidden = false;
        setStatus("Load error");
        alert("Couldn't load that version.\n\nReason: " + (e?.message || e));
      } finally {
        loading.hidden = true;
      }
    }

    // Fullscreen toggle (button + 'F' key)
    async function toggleFullscreen() {
      const el = document.documentElement;
      if (!document.fullscreenElement) {
        try { await el.requestFullscreen(); } catch {}
      } else {
        try { await document.exitFullscreen(); } catch {}
      }
    }

    // Wire up
    populate();
    sel.value = initialSelection();
    setStatus("Pick a version to start");
    playBtn.addEventListener("click", () => loadVersion(sel.value));
    fsBtn.addEventListener("click", toggleFullscreen);
    document.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "f") toggleFullscreen();
      if (e.key === "Enter" && document.activeElement === sel) loadVersion(sel.value);
    });

    // Optional: auto-play if URL already specifies ?version=
    if (new URLSearchParams(location.search).get("version")) {
      loadVersion(sel.value);
    }
  </script>
</body>
</html>

