<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Block by Block â€“ Smooth & Dynamic</title>
</head>
<body>
<h1>ðŸŽµ Block by Block â€“ Smooth & Dynamic</h1>
<button onclick="playSong()">Play Song</button>

<script>
const NOTES = {
  "C4":261.63,"D4":293.66,"E4":329.63,"F4":349.23,"G4":392.00,"A4":440.00,"B4":493.88,
  "C3":130.81,"D3":146.83,"E3":164.81,"F3":174.61,"G3":196.00,"A3":220.00,"B3":246.94,
  "REST":0
};

const CHORDS = {
  "C":["C4","E4","G4"],
  "F":["F4","A4","C4"],
  "G":["G4","B4","D4"],
  "Am":["A4","C4","E4"]
};

// Original melody + chords + bass (kept exactly as before)
const song = [
  ["C4","C","C3",0.5],["C4","C","C3",0.5],["E4","C","C3",0.5],["G4","C","C3",0.5],
  ["G4","F","F3",0.5],["E4","F","F3",0.5],["D4","G","G3",0.5],["C4","G","G3",0.5],
  ["E4","Am","A3",0.5],["E4","Am","A3",0.5],["G4","F","F3",0.5],["A4","F","F3",0.5],
  ["G4","C","C3",0.5],["E4","C","C3",0.5],["D4","G","G3",0.5],["C4","G","G3",1.0]
];

// Extra parts for intro, bridge, outro (same harmonic style)
const intro = [
  ["E4","C","C3",0.5],["G4","C","C3",0.5],["A4","F","F3",0.5],["G4","F","F3",0.5]
];
const bridge = [
  ["A4","Am","A3",0.5],["G4","F","F3",0.5],["E4","G","G3",0.5],["F4","C","C3",0.5]
];
const outro = [
  ["C4","C","C3",0.5],["E4","C","C3",0.5],["G4","C","C3",1.0]
];

function playTone(ctx, freq, dur, start, type="sine", vol=0.2) {
  if (freq===0) return;
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  const filter = ctx.createBiquadFilter();
  filter.type = "lowpass";
  filter.frequency.value = 5000;

  osc.type = type;
  osc.frequency.value = freq;
  osc.connect(filter);
  filter.connect(gain);
  gain.connect(ctx.destination);

  // Smooth envelope for less choppiness
  gain.gain.setValueAtTime(0, start);
  gain.gain.linearRampToValueAtTime(vol, start+0.02);
  gain.gain.linearRampToValueAtTime(vol*0.8, start+dur);
  gain.gain.linearRampToValueAtTime(0, start+dur+0.05);

  osc.start(start);
  osc.stop(start+dur+0.05);
}

function playSong() {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  let t = ctx.currentTime + 0.1;

  // Function to play a section
  function playSection(section, dynamics=1.0) {
    section.forEach(([mel, chord, bass, dur]) => {
      // Melody
      playTone(ctx, NOTES[mel], dur, t, "sine", 0.3*dynamics);
      // Chord
      CHORDS[chord].forEach(n => playTone(ctx, NOTES[n], dur, t, "triangle", 0.15*dynamics));
      // Bass
      playTone(ctx, NOTES[bass], dur, t, "square", 0.2*dynamics);
      t += dur;
    });
  }

  // Play with dynamics: intro soft, build up, bridge softer, final loud
  playSection(intro, 0.6);
  playSection(song, 0.8);
  playSection(bridge, 0.7);
  playSection(song, 1.0);
  playSection(outro, 0.5);
}
</script>
</body>
</html>
